We publish the wTest tool and the evaluation results in this page.

# Open-source subjects ([download](https://drive.google.com/file/d/16Gv8eZFS1Iy0onnscY9HZ7ivcf4gSMc6/view?usp=sharing))

The following table lists the 101 open-source Android apps used in our evaluation.

| Index | Package | Index | Package |
| --- | --- | --- | --- | 
| 1 | au.com.wallaceit.reddinator | 52 | org.sufficientlysecure.keychain |
| 2 | com.gacode.relaunchx | 53 | protect.budgetwatch |
| 3 | com.perflyst.twire | 54 | com.aaronhalbert.nosurfforreddit |
| 4 | com.gianlu.aria2app | 55 | com.gpl.rpg.AndorsTrail |
| 5 | io.github.hidroh.materialistic | 56 | com.workingagenda.fissure |
| 6 | org.billthefarmer.crossword | 57 | fr.ac_versailles.dane.xiaexpress |
| 7 | org.sufficientlysecure.termbot | 58 | net.etuldan.sparss.floss |
| 8 | net.bible.android.activity | 59 | org.nonononoki.hendroid |
| 9 | com.gelakinetic.mtgfam | 60 | pt.joaomneto.titancompanion |
| 10 | com.quaap.bookymcbookface | 61 | com.benny.openlauncher |
| 11 | de.tap.easy_xkcd | 62 | com.heb12.heb12 |
| 12 | io.pslab | 63 | cz.dvratil.fbeventsync |
| 13 | org.billthefarmer.diary | 64 | fr.free.nrw.commons |
| 14 | org.surrel.facebooknotifications | 65 | net.frju.flym |
| 15 | ca.rmen.android.networkmonitor | 66 | org.openhab.habdroid |
| 16 | com.gh4a | 67 | ru.yanus171.feedexfork |
| 17 | com.simplemobiletools.filemanager.pro | 68 | com.cityzen.cityzen |
| 18 | de.thecode.lmd | 69 | com.ichi2.anki |
| 19 | itkach.aard2 | 70 | de.baumann.browser |
| 20 | org.epstudios.epmobile | 71 | net.gsantner.markor |
| 21 | org.ttrssreader | 72 | org.openobservatory.ooniprobe |
| 22 | ca.rmen.android.poetassistant | 73 | se.oandell.riksdagen |
| 23 | com.tobykurien.webapps | 74 | com.cookiegames.smartcookie |
| 24 | de.vier_bier.habpanelviewer | 75 | com.lavadip.miniVector |
| 25 | jonas.tool.saveForOffline | 76 | de.baumann.hhsmoodle |
| 26 | org.floens.chan | 77 | info.puzz.a10000sentences |
| 27 | org.walleth | 78 | net.opendasharchive.openarchive.release |
| 28 | cgeo.geocaching | 79 | org.quantumbadger.redreader |
| 29 | com.github.catfriend1.syncthingandroid | 80 | com.danhasting.radar |
| 30 | com.tobykurien.webmediashare | 81 | com.manichord.mgit |
| 31 | ee.ioc.phon.android.speak | 82 | de.baumann.weather |
| 32 | jp.redmine.redmineclient | 83 | foss.cnugteren.nlweer |
| 33 | org.gittner.osmbugs | 84 | net.osmand.plus |
| 34 | org.wikipedia | 85 | org.schabi.newpipe |
| 35 | chat.rocket.android | 86 | org.andstatus.app |
| 36 | com.github.dfa.diaspora_android | 87 | com.mikifus.padland |
| 37 | com.totsp.crossword.shortyz | 88 | de.danoeh.antennapod |
| 38 | eu.kanade.tachiyomi | 89 | in.shick.diode |
| 39 | jwtc.android.chess | 90 | net.wigle.wigleandroid |
| 40 | org.kore.kolabnotes.android | 91 | org.seamapdroid |
| 41 | org.wordpress.android | 92 | com.duckduckgo.mobile.android |
| 42 | co.epitre.aelf_lectures | 93 | com.nextgis.mobile |
| 43 | com.github.doomsdayrs.apps.shosetsu | 94 | de.eidottermihi.raspicheck |
| 44 | com.uberspot.a2048 | 95 | io.github.fvasco.pinpoi |
| 45 | eu.quelltext.mundraub | 96 | nl.asymmetrics.droidshows |
| 46 | me.ccrama.redditslide | 97 | org.softeg.slartus.forpdaplus |
| 47 | org.liberty.android.fantastischmemo | 98 | com.etesync.syncadapter |
| 48 | org.zamedev.gloomydungeons2.opensource | 99 | com.nutomic.syncthingandroid |
| 49 | com.a5corp.weather | 100 | de.geeksfactory.opacclient |
| 50 | com.google.android.stardroid | 101 | io.github.gsantner.memetastic |
| 51 | com.wesaphzt.privatelocation | |

# Closed-source subjects ([download](https://drive.google.com/file/d/1tV5YE3GFZCV1MOm5qKMUlfdUw-WaEDkj/view?usp=sharing))

The following table lists the 50 closed-source Android apps used in our evaluation.

| Index | Package | Index | Package |
| --- | --- | --- | --- | 
| 1 | app.bpjs.mobile | 26 | com.fifthfinger.clients.joann |
| 2 | com.coolimg.picture.imgediting | 27 | com.lybrate.phoenix |
| 3 | com.iconology.comics | 28 | com.sec.app.samsungprintservice |
| 4 | com.northpark.beautycamera | 29 | com.usps |
| 5 | com.yahoo.mobile.client.android.weather | 30 | livio.pack.lang.en_US |
| 6 | org.jw.jwlibrary.mobile | 31 | video.downloader.videodownloader |
| 7 | com.cricbuzz.android.vernacular | 32 | cast.video.screenmirroring.casttotv |
| 8 | com.isysway.free.alquran | 33 | com.google.android.deskclock |
| 9 | com.oubapps.po.ch | 34 | com.mapfactor.navigator |
| 10 | com.tikfollowers.follower.like.tiktok.tik.tok.fans.likes.app | 35 | com.sony.psexp2016 |
| 11 | dating.app.chat.flirt.wgbcv | 36 | com.videos.kidstoysvids |
| 12 | qrcodereader.barcodescanner.scan.qrscanner | 37 | vsin.t16_funny_photo |
| 13 | com.eyewind.paperone | 38 | com.atomczak.notepat |
| 14 | com.jkfantasy.camera.jkpmirrorcamera | 39 | com.groupme.android |
| 15 | com.phone.launcher.lite | 40 | com.marvel.comics |
| 16 | com.til.timesnews | 41 | com.symantec.securewifi |
| 17 | home.solo.launcher.free | 42 | com.windyty.android |
| 18 | ru.apteka | 43 | mobi.infolife.ezweather |
| 19 | com.adsk.sketchbook | 44 | women.workout.female.fitness |
| 20 | com.fashion.tattoo.name.my.photo.editor | 45 | com.atomic.apps.ringtone.cutter |
| 21 | com.ladytimer.ovulationcalendar | 46 | com.hp.android.printservice |
| 22 | com.popularapp.thirtydayfitnesschallenge | 47 | com.ninetechnoz.pmawasyojana |
| 23 | com.topRingtones.TikTok | 48 | com.ted.android |
| 24 | splendid.postermaker.designer | 49 | com.xiaomi.midrop |
| 25 | com.amazon.storm.lightning.client.aosp | 50 | org.anddev.android.solfa_lite |

# Evaluation result
This section shows the data behind Figure 4-6 in the paper. You may see a real number "-1" in the data for Q-Testing and ComboDroid. This indicates Q-Testing or ComboDroid cannot successfully test the corresponding app (due to instrumentation issues or UiAutomator issues). When drawing Figure 4-6, these "-1"s were excluded.

* WebView-specific property coverage result for open-source apps ([view](https://docs.google.com/spreadsheets/d/12_43iCMPc_6Yw3Jv2oA8tX1PJiTIuOA-u4YBQVH5xU4/edit?usp=sharing))
* WebView-specific property coverage result for closed-source apps ([view](https://docs.google.com/spreadsheets/d/1QiVZNRuKSm8VZOxzr75L7oeQQx7thRNtSL5HfLBC7Fs/edit?usp=sharing))
* Code coverage result for open-source apps ([view](https://docs.google.com/spreadsheets/d/16oKC4fhdsjLvqqgzEU0sIh0XcjQi6BOEGAvf8gRXwpQ/edit?usp=sharing))
* Code coverage result for closed-source apps ([view](https://docs.google.com/spreadsheets/d/1FgUNnuMeX3VylW1gKL-fEjqLBsfAB3Y8I2nfl60gnVc/edit?usp=sharing))

# Bug Reproduction Steps

In this section, we provide the steps to reproduce the bugs in Table 2 whose link is on this website. We provide the app package name, a brief description of the bug, and the screenshots captured during reproduction.

### Bug o10 (ca.rmen.android.networkmonitor)
Scroll position of the Notices page is lost after device rotation

<img width="737" alt="Screen Shot 2021-08-31 at 9 23 03 PM" src="https://user-images.githubusercontent.com/67744580/131510166-14ddf88b-3f33-494f-b56a-704f3df84f4c.png">

### Bug o15 (chat.rocket.android)
Input texts are cleared after device rotation

<img width="629" alt="Screen Shot 2021-08-31 at 9 38 38 PM" src="https://user-images.githubusercontent.com/67744580/131512722-c1904073-7399-4e26-90ed-a7c062e807c4.png">

### Bug o17 (org.wordpress.android)
App crashes when rotating screen at WordAds page

<img width="938" alt="Screen Shot 2021-08-31 at 9 52 49 PM" src="https://user-images.githubusercontent.com/67744580/131515042-a151cdff-5068-4007-a8ea-98302d12126c.png">

### Bug o23 (com.ichi2.anki)
A card answer is lost after device orientation changes

<img width="933" alt="Screen Shot 2021-08-31 at 10 05 58 PM" src="https://user-images.githubusercontent.com/67744580/131517213-c3cfc3cf-24a1-4d38-95d5-74e1f19332f1.png">

### Bug c1 (org.jw.jwlibrary.mobile)
License agreement will disappear after device rotation

<img width="576" alt="Screen Shot 2021-08-31 at 10 22 31 PM" src="https://user-images.githubusercontent.com/67744580/131520101-2f2ac8fe-1ab1-4f8a-ae83-c0386fc6401c.png">

### Bug c2 (home.solo.launcher.free)
Privacy policy page and terms of services page get refresh after device rotation

<img width="777" alt="Screen Shot 2021-08-31 at 10 27 47 PM" src="https://user-images.githubusercontent.com/67744580/131520917-fcdd1311-cdff-4fcb-9f0f-cf42d6184485.png">

### Bug c3 (com.sec.app.samsungprintservice)
FAQ page refreshes after device rotation

<img width="583" alt="Screen Shot 2021-08-31 at 11 07 48 PM" src="https://user-images.githubusercontent.com/67744580/131527986-94850493-12d6-4254-a62e-75dc4f1b378e.png">

### Bug c4 (com.usps)
App crash after click privacy@usps.gov in the privacy policy page

<img width="604" alt="Screen Shot 2021-08-31 at 11 11 19 PM" src="https://user-images.githubusercontent.com/67744580/131528545-99de0418-fd04-4f6d-a5a3-b5a11fb8b85d.png">

### Bug c5 (com.marvel.comics)
Dialog disappear in the privacy notice page after device rotation

<img width="874" alt="Screen Shot 2021-08-31 at 11 31 10 PM" src="https://user-images.githubusercontent.com/67744580/131531930-0a5e9b7f-fa97-4b99-bbaa-dbf00babb50f.png">

### Bug c6 (com.groupme.android)
Press back and the app will not respond

<img width="812" alt="Screen Shot 2021-08-31 at 11 36 16 PM" src="https://user-images.githubusercontent.com/67744580/131532728-b3b92bce-b3bb-43e9-84ae-45651e805151.png">

### Bug c7 (com.atomczak.notepat)
FAQ page refreshes after device rotation

<img width="667" alt="Screen Shot 2021-09-01 at 2 54 36 PM" src="https://user-images.githubusercontent.com/67744580/131625900-2a49bfac-a415-443a-ac41-686a9bac70aa.png">

### Bug c8 (com.atomczak.notepat)
Privacy policy page refreshes after device rotation

<img width="666" alt="Screen Shot 2021-09-01 at 2 57 37 PM" src="https://user-images.githubusercontent.com/67744580/131626294-1adfbef6-42f2-4400-b50e-fb8d50115f09.png">

### Bug c9 (com.ninetechnoz.pmawasyojana)
Privacy policy page refreshes after device rotation

<img width="906" alt="Screen Shot 2021-09-01 at 3 09 09 PM" src="https://user-images.githubusercontent.com/67744580/131627824-8cf7c694-d1c1-4be6-a23c-cff1bf32d27b.png">

### Bug c10 (com.hp.android.printservice)
Rotate in HP Print Service Plugin and the page will refresh

<img width="676" alt="Screen Shot 2021-09-01 at 3 03 22 PM" src="https://user-images.githubusercontent.com/67744580/131626975-5bf79e15-028b-42c8-bd55-5653f508291d.png">

# Tool
Our tool is composed of two parts. The first part instruments an Android app. The second part generates tests for the instrumented app.
## Instrumentation tool ([download](https://drive.google.com/file/d/17VrvKvMA9Z3nWumj5mc2wZNHTplhHyIC/view?usp=sharing))
### Requirements
* Java 1.8 or above
* Python 2 or 3 (We have tested on Python 2.7.16 and Python 3.6.8)
* Node.js (We have tested on v12.16.2 and v10.16.0. You may find these versions [here](https://nodejs.org/en/download/releases/). If you are using a Linux-based OS, you may install node by following the steps [here](https://www.digizol.com/2017/08/nodejs-install-no-root-sudo-permission-linux-centos.html))

### Steps to use
* Create a folder for an app under test. The folder name should be the app's package name (We have created a folder for Wikipedia app under `Instrumentation-ICSE22-Submit/apps`).
* Run `sh instrument.sh APP_FOLDER APP_PACKAGE_NAME PORT_NUM APP_TYPE` to instrument an app (`APP_TYPE` can be `OPEN_SOURCE` or `CLOSE_SOURCE`. We will explain `PORT_NUM` later. An example command can be `sh instrument.sh apps/org.wikipedia org.wikipedia 3016 OPEN_SOURCE`).
* When instrumentation finishes, you can see an `output` folder under the `APP_FOLDER`. The apk file whose name ends with `-aligned-debugSigned.apk` is the instrumented apk.


## Test generation (wTest) ([download](https://drive.google.com/file/d/1NCSZ5SVAI93uDZHW8RtnivRJY3RNDAj_/view?usp=sharing))
### Prerequisite
The instrumented app needs to run on a customized Android system because there are some added fields (e.g., the ID) in the instrumented app that the orginal Android system doesn't have. It is very simple to use our customized Android system image, you just need to follow the following two steps
* Download our customized [system.img](https://drive.google.com/file/d/1t2g56Bx_D3pPbPTUftS9uHMD9-IFeqfS/view?usp=sharing) and [ramdisk.img](https://drive.google.com/file/d/1V0z3V87QZSrz_4SMUIJKSDioIwPFVRhB/view?usp=sharing) (They are for Android 24)
* Replace the original `system.img` and `ramdisk.img` in your Android SDK with the downloaded two `.img` files

Usually, both of `system.img` and `ramdisk.img` are placed under `<Android_SDK_Root>/system-images/android-24/google_apis/x86`

Once you have finished the above two steps, you can try to start the Android emulator as usual.

### Environment requirements
* `export JAVA_HOME=YOUR_JAVA_HOME` (example: `export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/`)
* `export ANDROID_HOME=YOUR_ANDROID_HOME` (example: `export ANDROID_HOME=/Library/Android/sdk`)
* `export PATH=$PATH:${ANDROID_HOME}`
* `export PATH=$PATH:<Path_to_wTest>/node_modules/.bin` (make sure you have downloaded `wTest`)
* `export PATH=$PATH:${ANDROID_HOME}/emulator`
* `export PATH=$PATH:${ANDROID_HOME}/platform-tools`

### Steps to use
* Enter `<path_to_Instrumentation-ICSE22-Submit>/js` and run `sh launchServer.sh PORT_NUM`. This little server is registered on a `PORT_NUM` in order to recevice JavaScript code that is dynamically constructed in the app under test. The server is responsible for instrumenting the js code and sending the instrumented code back to the app. `PORT_NUM` should be the same as the one used when instrumenting the app. An example command can be `sh launchServer.sh 3016`
* Launch Appium by `appium -p APPIUM_PORT` (example: `appium -p 4723`)
* Launch an Android emulator
* Enter `<path_to_wTest>` and run `sh wTest.sh PATH_TO_APP_FOLDER TIME_LIMIT ANDROID_SDK_PATH EMULATOR_ID APPIUM_PORT APP_TYPE` (Example: `sh wTest.sh <path_to_Instrumentation-ICSE22-Submit>/apps/org.wikipedia 3600 /Library/Android/sdk emulator-5554 4723 OPEN_SOURCE`)
* When wTest finishes testing, you can see the output under `<path_to_wTest>/output/wVar/org.wikipedia`. Under this folder, `coverage.txt` contains WebView-specific property coverage and code/method coverage results.

